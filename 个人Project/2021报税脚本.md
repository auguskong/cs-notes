我的需求



将Robinhood / TD 的1099表格当中被标记为Wash Sale的所有交易记录找到并提取出来



将找到的交易记录添加到8949表单PDF中



如果一张表单文件放不下的话 需要用到多张表单 并自动命名? 或者说是重用 最后能够直接打印



不断尝试 -> 实验 -> 确定能不能work



先将PDF 转为 CSV 从CSV中读取数据 -> 将CSV



设计到的操作:

1. 文件导入 文件内容提取
2. 文件写入  
3. 多个文件的拆分
4. 文件的导出



一个文件就搞定了



看起来比较靠谱

TrapRange:  直接从页面截取特定坐标的元素算法  

https://github.com/thoqbk/traprange



原理介绍文章: https://dzone.com/articles/traprange-method-extract-table





另一个思路是先把PDF转成图片 然后用OpenCV进行表格数据的提取

详情: https://stackoverflow.com/questions/47533875/how-to-extract-table-as-text-from-the-pdf-using-python



PyPDF2 是读取Text 或者基本的PDF文件操作 分隔、合并、转换

Documentation: 

https://pythonhosted.org/PyPDF2/index.html

PyPDF2的一些基本操作

https://automatetheboringstuff.com/chapter13/





OCRmyPDF: 将PDF 转换成可以搜索的

https://github.com/jbarlow83/OCRmyPDF



Pdfminder: 能提取简单信息

https://github.com/pdfminer/pdfminer.six 

https://pdfminersix.readthedocs.io/en/latest/index.html





## Debug

* 
* 运行 
* ERROR: Could not find a version that satisfies the requirement requirements.txt (from versions: none)`

需要使用`-r`来表示我们是从一个 requirement file 中安装 `pip install -r requirements.txt` 

```
-r, --requirement <file>    Install from the given requirements file. This option can be used multiple times.
```



需要disable vimium 来启用Jupyter Notebook 的快捷键





## Research

pdfminer: https://pdfminer-docs.readthedocs.io/programming.html



pdfminer class relationship

![image-20210321130214577](/Users/xiangyu/Library/Application Support/typora-user-images/image-20210321130214577.png)



* `PDFParser`: fetch data from a filie
* `PDFDocument`: store data
* `PDFPageInterpreter`: process the page contents
* `PDFDevice`: translate page contents
* `PDFResourceManger`: store shared resources such as fonts or images



Layout Representation

![image-20210321130044962](/Users/xiangyu/Library/Application Support/typora-user-images/image-20210321130044962.png)



PDF is more like a graphic representation. In most cases, it has no logical structure such as sentences or paragraphs and it cannot adapt itself when the paper size changes.



先做拆分 然后再进行提取



## Demo 源码分析



为什么要先提取characters  -> rows -> texts ? 

用什么算法来找到每一行? 



TextBox 可以用数学公式来进行计算和拆分吗?  e.g. 每相邻9个box 是同一行的? 



最后能够直接提取出来每一行的信息 但是有的时候 various 是单独在一个List当中 有的时候不是 这是为什么呢? 



同时还需要过滤掉 Total的  作为过滤条件的选项: 

* List 的长度 `len(texts[34]) == 8`
* 正则表达式 
* 是否包单个的`W` 字符



过滤的话是用哪个function ?





搞定了从第一页里面进行提取 现在要把所有页面的都取出来

加一个for loop 即可

`page_layouts` contains all information 

loop through every page to extract information 



extract_text 

extract_characters

arrange+text

